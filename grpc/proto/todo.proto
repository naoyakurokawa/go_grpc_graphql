syntax = "proto3";

package task;

option go_package = "/pb";

import "google/protobuf/timestamp.proto";

message Task {
  uint64 id = 1;
  string title = 2;
  string note = 3;
  int32 completed = 4;
  google.protobuf.Timestamp created_at = 5;
  google.protobuf.Timestamp updated_at = 6;
  uint64 category_id = 7;
  google.protobuf.Timestamp due_date = 8;
  google.protobuf.Timestamp completed_at = 9;
  repeated SubTask sub_tasks = 10;
  uint64 user_id = 11;
}

message NewTask {
  string title = 1;
  string note = 2;
  uint64 category_id = 3;
  google.protobuf.Timestamp due_date = 4;
}

message UpdateTask {
  uint64 id = 1;
  optional string title = 2;
  optional string note = 3;
  optional int32 completed = 4;
  optional uint64 category_id = 5;
  optional google.protobuf.Timestamp due_date = 6;
  optional google.protobuf.Timestamp completed_at = 7;
}

message TaskList {
  repeated Task tasks = 1;
}

message User {
  uint64 id = 1;
  string email = 2;
  google.protobuf.Timestamp created_at = 3;
  google.protobuf.Timestamp updated_at = 4;
}

message SubTask {
  uint64 id = 1;
  uint64 task_id = 2;
  string title = 3;
  string note = 4;
  int32 completed = 5;
  google.protobuf.Timestamp completed_at = 6;
  google.protobuf.Timestamp due_date = 7;
  google.protobuf.Timestamp created_at = 8;
  google.protobuf.Timestamp updated_at = 9;
}

message NewSubTask {
  uint64 task_id = 1;
  string title = 2;
  string note = 3;
  google.protobuf.Timestamp due_date = 4;
}

message ToggleSubTaskRequest {
  uint64 id = 1;
  bool completed = 2;
}

message SubTaskList {
  repeated SubTask sub_tasks = 1;
}

message LoginRequest {
  string email = 1;
  string password = 2;
}

message LoginResponse {
  uint64 user_id = 1;
}

message GetUserRequest {
  uint64 id = 1;
}

message TaskId {
  uint64 id = 1;
}

message GetTasksRequest {
  optional uint64 category_id = 1;
  optional google.protobuf.Timestamp due_date_start = 2;
  optional google.protobuf.Timestamp due_date_end = 3;
  optional bool incomplete_only = 4;
}

message CreateTaskRequest {
  NewTask input = 1;
}

message UpdateTaskRequest {
  UpdateTask input = 1;
}

message DeleteTaskResponse {
  bool success = 1;
}

message CreateSubTaskRequest {
  NewSubTask input = 1;
}

service TaskService {
  rpc GetTasks (GetTasksRequest) returns (TaskList);
  rpc CreateTask (CreateTaskRequest) returns (Task);
  rpc UpdateTask (UpdateTaskRequest) returns (Task);
  rpc DeleteTask (TaskId) returns (DeleteTaskResponse);
  rpc CreateSubTask (CreateSubTaskRequest) returns (SubTask);
  rpc ToggleSubTask (ToggleSubTaskRequest) returns (SubTask);
  rpc ListSubTasks (TaskId) returns (SubTaskList);
}

service AuthService {
  rpc Login (LoginRequest) returns (LoginResponse);
  rpc GetUser (GetUserRequest) returns (User);
}
